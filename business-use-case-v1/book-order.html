<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Parcel My Box – Book Order</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto Slab', serif;
      zoom: 133%;
      margin: 0;
      padding: 0;
      background: #f2f2f2;
    }

    h1 {
      text-align: center;
      margin-top: 70px;
      margin-bottom: 30px;
    }

    .back-home {
      position: absolute;
      top: 20px;
      left: 20px;
      color: #007BFF;
      font-weight: bold;
      text-decoration: none;
      font-size: 16px;
    }

    .back-home i {
      margin-right: 6px;
    }

    .box {
      background: white;
      padding: 25px;
      margin: 30px auto;
      width: 90%;
      max-width: 1100px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .box h2 {
      margin-top: 0;
    }

    .box-summary {
      font-weight: bold;
      margin-bottom: 20px;
    }

.item {
  border: 1px solid #ddd;
  padding: 40px 20px 20px 20px; /* top padding increased */
  margin-bottom: 25px;
  background: #f9f9f9;
  border-radius: 8px;
  position: relative;
}


    .item::before {
      content: attr(data-item-tag);
      position: absolute;
      top: 10px;
      left: 15px;
      font-weight: bold;
      background-color: #007BFF;
      color: white;
      padding: 2px 8px;
      font-size: 13px;
      border-radius: 4px;
    }

    .item-grid,
    .item-grid-3 {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .item-grid label,
    .item-grid-3 label {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .item-grid-3 label {
      flex: 1;
    }

    .item-grid:last-child label:first-child {
      flex: 0 0 auto;
      width: 100px;
    }

    .item-grid:last-child label:last-child {
      flex: 1;
    }

    textarea, input, select {
      padding: 8px;
      font-family: inherit;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 100%;
      box-sizing: border-box;
    }

    .actions {
      margin-top: 10px;
    }

    .btn {
      background: #007BFF;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
    }

    .btn-sm {
      padding: 6px 10px;
      font-size: 12px;
    }

    .delete-icon {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 16px;
      color: #dc3545;
      cursor: pointer;
    }

    .delete-icon i {
      pointer-events: none;
    }

    #form-container {
      padding-bottom: 40px;
    }

    .button-group {
      text-align: center;
      margin-bottom: 40px;
    }
  </style>
</head>
<body>

  <a href="index.html" class="back-home"><i class="fa-solid fa-arrow-left"></i>Back to Home</a>

  <h1>Book Your Shipment</h1>
  <div id="form-container"></div>

  <div class="button-group">
    <button class="btn" onclick="addNewItem()">Add Item</button>
     <button class="btn" onclick="confirmOrder()">Confirm Order</button>
  </div>

  <script>
    let itemCount = 0;
    let currentBox = 1;
    const maxWeightPerBox = 25;
    const boxWeights = {};

    const formContainer = document.getElementById("form-container");

    function goHome() {
      alert("This would link to home page.");
    }

    function createBox(boxNumber) {
      const box = document.createElement("div");
      box.className = "box";
      box.id = `box-${boxNumber}`;
      box.innerHTML = `
        <h2>BOX ${boxNumber}</h2>
        <div class="box-summary" id="box-${boxNumber}-summary">
          Total Weight: 0.00 kg | You can add 25.00 kg more
        </div>
      `;
      formContainer.appendChild(box);
      boxWeights[boxNumber] = 0;
      return box;
    }

    function updateBoxSummary(boxNumber) {
      const summary = document.getElementById(`box-${boxNumber}-summary`);
      const total = boxWeights[boxNumber].toFixed(2);
      const remaining = (maxWeightPerBox - boxWeights[boxNumber]).toFixed(2);
      summary.textContent = `Total Weight: ${total} kg | You can add ${remaining} kg more`;
    }

    function addNewItem() {
      itemCount++;

      let box = document.getElementById(`box-${currentBox}`);
      if (!box) {
        box = createBox(currentBox);
      }

      const itemDiv = document.createElement("div");
      itemDiv.className = "item";
      itemDiv.id = `item-${itemCount}`;
      itemDiv.setAttribute('data-item-tag', `I T E M #${itemCount}`);

      itemDiv.innerHTML = `
        <div class="item-grid">
          <label>Item Type:
            <select class="item-type">
              <option>Glass</option>
              <option>Plastic</option>
              <option>Wooden Items</option>
              <option>Clothes</option>
              <option>Food</option>
              <option>Kitchen Utensils</option>
              <option>Beauty Items</option>
              <option>Bath Items</option>
              <option>Goods</option>
            </select>
          </label>
          <label>Item Name: <input type="text" class="item-name"></label>
        </div>

        <div class="item-grid">
          <label>Weight (kg): <input type="number" step="0.01" class="item-weight"></label>
          <label>Quantity: <input type="number" class="item-qty" min="1" value="1"></label>
        </div>

        <div class="item-grid-3">
          <label>Length (cm): <input type="number" class="item-len"></label>
          <label>Width (cm): <input type="number" class="item-wid"></label>
          <label>Height (cm): <input type="number" class="item-hei"></label>
        </div>

        <div class="item-grid">
          <label>Fragile? <input type="checkbox" class="item-fragile"></label>
          <label>Special Requirements:
            <textarea class="item-notes" rows="2" placeholder="Optional notes"></textarea>
          </label>
        </div>

        <div class="actions">
          <button class="btn btn-sm" onclick="confirmItem(this)">Confirm Item</button>
        </div>
      `;

      box.appendChild(itemDiv);
    }

    function confirmItem(button) {
      const itemDiv = button.closest(".item");
      const weight = parseFloat(itemDiv.querySelector(".item-weight").value) || 0;
      const qty = parseInt(itemDiv.querySelector(".item-qty").value) || 0;
      const totalWeight = weight * qty;

      if (totalWeight === 0) {
        alert("Please enter valid weight and quantity.");
        return;
      }

      if (boxWeights[currentBox] + totalWeight > maxWeightPerBox) {
        currentBox++;
        createBox(currentBox);
        boxWeights[currentBox] = 0;
        document.getElementById(`box-${currentBox}`).appendChild(itemDiv);
      }

      boxWeights[currentBox] += totalWeight;
      updateBoxSummary(currentBox);

      itemDiv.querySelectorAll("input, select, textarea").forEach(input => input.disabled = true);

      const deleteIcon = document.createElement("button");
      deleteIcon.className = "delete-icon";
      deleteIcon.innerHTML = `<i class="fa-light fa-trash-can"></i>`;
      deleteIcon.onclick = () => deleteItem(deleteIcon, totalWeight);
      itemDiv.appendChild(deleteIcon);

      const actionsDiv = itemDiv.querySelector(".actions");
      actionsDiv.innerHTML = `
        ✅ Confirmed (Box ${currentBox}, Total Weight: ${totalWeight.toFixed(2)} kg)
        <button class="btn btn-sm" onclick="editItem(this)">✏️ Edit</button>
      `;
    }

    function editItem(button) {
      const itemDiv = button.closest(".item");
      itemDiv.querySelectorAll("input, select, textarea").forEach(input => input.disabled = false);

      const existingDelete = itemDiv.querySelector(".delete-icon");
      if (existingDelete) existingDelete.remove();

      const actionsDiv = itemDiv.querySelector(".actions");
      actionsDiv.innerHTML = `
        <button class="btn btn-sm" onclick="confirmItem(this)">✅ Re-Confirm Item</button>
      `;
    }

    function deleteItem(button, itemWeight) {
      const itemDiv = button.closest(".item");
      const boxId = itemDiv.closest(".box").id;
      const boxNumber = parseInt(boxId.split("-")[1]);

      boxWeights[boxNumber] -= itemWeight;
      updateBoxSummary(boxNumber);
      itemDiv.remove();
    }
      function confirmOrder() {
    const items = document.querySelectorAll(".item");
    const rows = [["Box Number", "Item Type", "Item Name", "Weight", "Quantity", "Length", "Width", "Height", "Fragile", "Special Notes"]];

    items.forEach(item => {
      const box = item.closest(".box");
      const boxNumber = box ? box.id.replace("box-", "") : "N/A";

      const row = [
        boxNumber,
        item.querySelector(".item-type")?.value || "",
        item.querySelector(".item-name")?.value || "",
        item.querySelector(".item-weight")?.value || "",
        item.querySelector(".item-qty")?.value || "",
        item.querySelector(".item-len")?.value || "",
        item.querySelector(".item-wid")?.value || "",
        item.querySelector(".item-hei")?.value || "",
        item.querySelector(".item-fragile")?.checked ? "Yes" : "No",
        item.querySelector(".item-notes")?.value || ""
      ];
      rows.push(row);
    });

    const csvContent = "data:text/csv;charset=utf-8," + rows.map(e => e.join(",")).join("\n");
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", "parcel_items.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    // After download, go to recommendation page
    window.location.href = "recommendation.html";
  }
  </script>
</body>
</html>
