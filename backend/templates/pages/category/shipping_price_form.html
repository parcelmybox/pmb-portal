{% extends "base/base.html" %}

{% block title %}Shipping Price Estimator{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h1 class="mb-4">Shipping Price Estimator</h1>
        <form id="priceForm">
            <div class="mb-3">
                <label for="source_pin" class="form-label">Source PIN (India)</label>
                <input type="text" id="source_pin" class="form-control" required />
            </div>
            <div class="mb-3">
                <label for="destination_zip" class="form-label">Destination ZIP (USA)</label>
                <input type="text" id="destination_zip" class="form-control" required />
            </div>
            <div class="mb-3">
                <label for="weight" class="form-label">Weight (kg)</label>
                <input type="number" id="weight" step="0.01" class="form-control" required />
            </div>
            <button type="submit" class="btn btn-primary">Get Estimated Price</button>
        </form>

        <div class="mt-4" id="result"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('priceForm');
            const resultDiv = document.getElementById('result');

            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const data = {
                    source_pin: document.getElementById('source_pin').value,
                    destination_zip: document.getElementById('destination_zip').value,
                    weight: document.getElementById('weight').value,
                };

                try {
                    const response = await fetch('/api/shipping-price/', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(data),
                    });

                    const json = await response.json();

                    if (response.ok) {
                        resultDiv.innerHTML = `<div class="alert alert-success">
                            <h4>Estimated Price: $${json.estimated_price.toFixed(2)}</h4>
                        </div>`;
                    } else {
                        resultDiv.innerHTML = `<div class="alert alert-danger">
                            Error: ${json.error || 'Failed to get shipping estimate'}
                        </div>`;
                    }
                } catch (error) {
                    resultDiv.innerHTML = `<div class="alert alert-danger">
                        Error: Failed to connect to the server. Please try again later.
                    </div>`;
                    console.error('Error:', error);
                }
            });
        });
    </script>
</div>
</div>
</div>
{% endblock %}
